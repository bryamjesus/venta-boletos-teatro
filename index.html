<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reto 3 - Bryam Jesus Talledo Garcia</title>

    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
  </head>
  <body>
    <header class="">
      <nav class="container py-3">
        <span>Teatro Peruano</span>
      </nav>
    </header>

    <main>
      <section class="container section py-5 px-5">
        <div class="row g-3 needs-validation">
          <div class="col-md-6">
            <label for="txtNombre" class="form-label">Nombres</label>
            <input type="text" class="form-control" id="txtNombre" required />
          </div>
          <div class="col-md-6">
            <label for="txtApellido" class="form-label">Apellidos</label>
            <input type="text" class="form-control" id="txtApellido" required />
          </div>
          <!-----------------------------------NOMBRES Y APELLIDO-------------------------------->

          <div class="col-12">
            <label for="txtNombre" class="form-label">Obra</label>
            <select
              id="selectObra"
              class="form-select my-1"
              aria-label="Default select example"
              required
            >
              <option value selected>Seleccione una obra</option>
              <option value="La divina comedia">La divina comedia</option>
              <option value="La vida es sueño">La vida es sueño</option>
              <option value="El fantasma de la ópera">
                El fantasma de la ópera
              </option>
              <option value="Fuenteovejuna">Fuenteovejuna</option>
              <option value="La celestina">La celestina</option>
            </select>
          </div>
          <!-----------------------------------OBRA-------------------------------->

          <div class="col-md-6">
            <label for="inputEmail4" class="form-label">Edad</label>
            <input
              id="txtAge"
              type="number"
              class="form-control"
              aria-label="First name"
              min="10"
              max="100"
            />
          </div>
          <div class="col-md-6 d-flex flex-column">
            <!-- <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="chboxEstudiante"
              />
              <label class="form-check-label" for="chboxEstudiante">
                Estudiante
              </label>
            </div> -->

            <label for="estudiante" class="form-label d-block"
              >Estudiante</label
            >
            <div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="estudiante"
                  id="estudianteSi"
                  value="Si"
                  checked
                />
                <label class="form-check-label" for="estudianteSi">Si</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="estudiante"
                  id="estudianteNo"
                  value="No"
                />
                <label class="form-check-label" for="estudianteNo">No</label>
              </div>
            </div>
          </div>
          <!-----------------------------------EDAD Y ESTUDIANTE-------------------------------->

          <div class="col-12">
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="chboxTarjeta"
              />
              <label class="form-check-label" for="chboxTarjeta">
                Pago con tarjeta de crédito
              </label>
            </div>
          </div>
          <div class="col-12">
            <button
              onclick="calcularPrecio()"
              id="calcular"
              class="btn btn-primary"
              disabled
            >
              Calcular
            </button>
          </div>
        </div>
        <!-----------------------------------BUTTON-------------------------------->
      </section>
      <section
        id="boleta"
        class="boleta container py-5"
        style="background-color: #f3f3f3; border-radius: 10px"
      ></section>
    </main>

    <script type="text/javascript">
      const boleta = document.getElementById("boleta");
      const selectObra = document.getElementById("selectObra");
      const txtNombre = document.getElementById("txtNombre");
      const txtApellido = document.getElementById("txtApellido");
      const txtAge = document.getElementById("txtAge");
      const rbEstudiante = document.getElementsByName("estudiante");
      const chboxTarjeta = document.getElementById("chboxTarjeta");
      const btnCalcular = document.getElementById("calcular");

      window.addEventListener("click", () => validar());

      window.addEventListener("keyup", () => validar());

      const calcularPrecio = () => {
        botonCalcular(true);
        mostrarDatos();
        mostrarPrecio();
      };

      const mostrarDatos = () => {
        const div = document.createElement("div");
        const factura = document.getElementById("factura");

        if (factura) {
          boleta.removeChild(factura);
          div.id = "factura";
          div.innerHTML = precioFactura();
        } else {
          div.id = "factura";
          div.innerHTML = precioFactura();
        }

        boleta.appendChild(div);
      };

      const mostrarPrecio = () => {
        const div = document.createElement("div");
        const precio = document.getElementById("precio");

        if (precio) {
          boleta.removeChild(precio);
          div.id = "precio";
          div.innerHTML = precioTexto();
        } else {
          div.id = "precio";
          div.innerHTML = precioTexto();
        }

        boleta.appendChild(div);
      };

      const pagar = () => {
        const precio = document.getElementById("precio");
        const factura = document.getElementById("factura");
        boleta.removeChild(precio);
        boleta.removeChild(factura);
        limpiar();
        botonCalcular(false);
      };

      const eliminar = () => pagar();

      const precioFactura = () => {
        return `
        <h4 class="pb-3 m-0">Factura</h4>
        <div class="row g-3">
          <div class="row mb-2 px-5">
            <h5 class="col-sm-2">Obra</h5>
            <div class="col-sm-10">
              <p>${selectObra.value}</p>
            </div>
          </div>
          <div class="row mb-2 px-5">
            <h5 class="col-sm-2">Nombre</h5>
            <div class="col-sm-10">
              <p>${txtNombre.value} ${txtApellido.value}</p>
            </div>
          </div>

          <div class="row px-5">
            <div class="col-sm">
              <h5 class="form-label">Edad:</h5>
              <p>${txtAge.value}</p>
            </div>
            <div class="col-sm">
              <h5 class="form-label">Estudiante:</h5>
              <p>${rptaEstudiante()}</p>
            </div>
            <div class="col-sm">
              <h5 for="inputZip" class="form-label">
                Pago con tarjeta de crédito:
              </h5>
              <p>${rptaCheckBox(chboxTarjeta)}</p>
            </div>
          </div>
        </div>`;
      };

      const precioTexto = () => {
        return `
        <h4 class="pb-3 pt-2 m-0">Precio</h4>
        <div class="px-5">
          <p><strong>Boleto: </strong> S/. ${precio()}</p>
          <p><strong>Descuento(10%): </strong>${
            descuento() === 0 ? "-" : descuento()
          }</p>
          <p class = "bg-info p-2"><strong>Total: S/. ${precioFinal()}</strong></p>
          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button onclick="pagar()" class="btn btn-outline-success" type="button">
              <i class="bi bi-cash-stack"></i> Pagar
            </button>
            <button onclick="eliminar()" class="btn btn-outline-danger" type="button">
              <i class="bi bi-trash3-fill"></i> Eliminar
            </button>
          </div>
        </div>`;
      };

      const precio = () => {
        const estudiante = rptaEstudiante() === "Si" ? true : false;
        return txtAge.value < 12 || estudiante ? 7 : 18;
      };

      const descuento = () =>
        chboxTarjeta.checked ? 0 : (precio() * 0.1).toFixed(2);

      const precioFinal = () => precio() - descuento();

      const validar = () =>
        selectObra.value && txtNombre.value && txtApellido.value && txtAge.value
          ? (btnCalcular.disabled = false)
          : (btnCalcular.disabled = true);

      const rptaEstudiante = () => {
        for (var radio of rbEstudiante) {
          if (radio.checked) {
            return radio.value;
          }
        }
      };

      const rptaCheckBox = (checkboxValidar) =>
        checkboxValidar.checked ? "Si" : "No";

      const botonCalcular = (tocado) =>
        (btnCalcular.textContent = tocado ? "Volver a calular" : "Calcular");

      const limpiar = () => {
        txtNombre.value = "";
        txtApellido.value = "";
        txtAge.value = "";
        chboxTarjeta.checked = false;
        selectObra.selectedIndex = 0;
        rbEstudiante[0].checked = true;
        txtNombre.focus();
      };
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
      integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
      integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
